{
  "manifest_version": "2",
  "task_list": [
    {
      "name": "Stardist Segmentation",
      "category": "Segmentation",
      "tags": [
        "Instance Segmentation",
        "Classical segmentation",
        "2D",
        "3D"
      ],
      "docs_info": "### Purpose\n- **Segments images using Stardist models**.\n- Supports both **built-in Stardist models** (shipped with Stardist) and **user-trained models**.\n- Accepts single channel image input for segmentation.\n- Can process **arbitrary regions of interest (ROIs)**, including whole images, fields of view (FOVs), or masked outputs from prior segmentations, based on corresponding ROI tables.\n- Provides access to all advanced Stardist parameters.\n\n### Outputs\n- Generates a new label image named `<channel_identifier>_segmented` if no label name is provided.\n",
      "type": "parallel",
      "executable_parallel": "stardist_segmentation_task.py",
      "meta_parallel": {
        "cpus_per_task": 4,
        "mem": 16000,
        "needs_gpu": true
      },
      "args_schema_parallel": {
        "$defs": {
          "AdvancedStardistParams": {
            "description": "Advanced Stardist Parameters",
            "properties": {
              "normalization": {
                "$ref": "#/$defs/NormalizationParameters",
                "default": {
                  "norm_type": "default",
                  "lower_percentile": null,
                  "upper_percentile": null,
                  "lower_bound": null,
                  "upper_bound": null
                },
                "title": "Normalization"
              },
              "sparse": {
                "default": true,
                "title": "Sparse",
                "type": "boolean"
              },
              "prob_thresh": {
                "title": "Prob Thresh",
                "type": "number"
              },
              "nms_thresh": {
                "title": "Nms Thresh",
                "type": "number"
              },
              "scale": {
                "default": [
                  1.0,
                  1.0,
                  1.0
                ],
                "maxItems": 3,
                "minItems": 3,
                "prefixItems": [
                  {
                    "type": "number"
                  },
                  {
                    "type": "number"
                  },
                  {
                    "type": "number"
                  }
                ],
                "title": "Scale",
                "type": "array"
              },
              "n_tiles": {
                "default": [
                  1,
                  1,
                  1
                ],
                "maxItems": 3,
                "minItems": 3,
                "prefixItems": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": "integer"
                  },
                  {
                    "type": "integer"
                  }
                ],
                "title": "N Tiles",
                "type": "array"
              },
              "show_tile_progress": {
                "default": false,
                "title": "Show Tile Progress",
                "type": "boolean"
              },
              "verbose": {
                "default": false,
                "title": "Verbose",
                "type": "boolean"
              },
              "predict_kwargs": {
                "additionalProperties": true,
                "title": "Predict Kwargs",
                "type": "object"
              },
              "nms_kwargs": {
                "additionalProperties": true,
                "title": "Nms Kwargs",
                "type": "object"
              }
            },
            "title": "AdvancedStardistParams",
            "type": "object"
          },
          "IteratorConfiguration": {
            "description": "Advanced Masking configuration.",
            "properties": {
              "masking": {
                "$ref": "#/$defs/MaskingConfiguration",
                "title": "Masking Iterator Configuration",
                "description": "If configured, the segmentation will be only saved within the mask region."
              },
              "roi_table": {
                "title": "Iterate Over ROIs",
                "type": "string",
                "description": "Name of a ROI table. If provided, the segmentation will be performed for each ROI in the specified ROI table."
              }
            },
            "title": "IteratorConfiguration",
            "type": "object"
          },
          "MaskingConfiguration": {
            "description": "Masking configuration.",
            "properties": {
              "mode": {
                "default": "Table Name",
                "enum": [
                  "Table Name",
                  "Label Name"
                ],
                "title": "Mode",
                "type": "string",
                "description": "Mode of masking to be applied. If \"Table Name\", the identifier refers to a masking table name. If \"Label Name\", the identifier refers to a label image name."
              },
              "identifier": {
                "title": "Identifier",
                "type": "string",
                "description": "Name of the masking table or label image depending on the mode."
              }
            },
            "title": "MaskingConfiguration",
            "type": "object"
          },
          "NormalizationParameters": {
            "description": "Validator to handle different normalization scenarios for Stardist models",
            "properties": {
              "norm_type": {
                "default": "default",
                "enum": [
                  "default",
                  "custom",
                  "no_normalization"
                ],
                "title": "Norm Type",
                "type": "string"
              },
              "lower_percentile": {
                "maximum": 100,
                "minimum": 0,
                "title": "Lower Percentile",
                "type": "number"
              },
              "upper_percentile": {
                "maximum": 100,
                "minimum": 0,
                "title": "Upper Percentile",
                "type": "number"
              },
              "lower_bound": {
                "title": "Lower Bound",
                "type": "integer"
              },
              "upper_bound": {
                "title": "Upper Bound",
                "type": "integer"
              }
            },
            "title": "NormalizationParameters",
            "type": "object"
          },
          "StardistChannel": {
            "description": "Stardist channel configuration.",
            "properties": {
              "mode": {
                "default": "label",
                "enum": [
                  "label",
                  "wavelength_id",
                  "index"
                ],
                "title": "Mode",
                "type": "string"
              },
              "identifiers": {
                "items": {
                  "type": "string"
                },
                "maxItems": 2,
                "minItems": 1,
                "title": "Identifiers",
                "type": "array"
              }
            },
            "title": "StardistChannel",
            "type": "object"
          },
          "StardistModels": {
            "description": "Enum for Stardist model names",
            "enum": [
              "2D_versatile_fluo",
              "2D_versatile_he",
              "2D_paper_dsb2018",
              "2D_demo",
              "3D_demo"
            ],
            "title": "StardistModels",
            "type": "string"
          },
          "StardistpretrainedModel": {
            "description": "Parameters to load a custom pretrained model",
            "properties": {
              "base_fld": {
                "title": "Base Fld",
                "type": "string"
              },
              "pretrained_model_name": {
                "title": "Pretrained Model Name",
                "type": "string"
              }
            },
            "required": [
              "base_fld",
              "pretrained_model_name"
            ],
            "title": "StardistpretrainedModel",
            "type": "object"
          }
        },
        "additionalProperties": false,
        "properties": {
          "zarr_url": {
            "title": "Zarr Url",
            "type": "string",
            "description": "URL to the OME-Zarr container"
          },
          "channel": {
            "$ref": "#/$defs/StardistChannel",
            "title": "Channel",
            "description": "Channel to use for segmentation."
          },
          "label_name": {
            "title": "Label Name",
            "type": "string",
            "description": "Name of the resulting label image. If not provided, it will be set to \"<channel_identifier>_segmented\"."
          },
          "level_path": {
            "title": "Level Path",
            "type": "string",
            "description": "If the OME-Zarr has multiple resolution levels, the level to use can be specified here. If not provided, the highest resolution level will be used."
          },
          "iterator_configuration": {
            "$ref": "#/$defs/IteratorConfiguration",
            "title": "Iterator Configuration",
            "description": "Configuration for the segmentation iterator. This can be used to specify masking and/or a ROI table."
          },
          "model_type": {
            "$ref": "#/$defs/StardistModels",
            "default": "3D_demo",
            "title": "Model Type",
            "description": "Parameter of `Stardist_ModelNames` class. Defines which model should be used. E.g. `2D_versatile_fluo`, `2D_versatile_he`, `2D_demo`, `3D_demo`."
          },
          "custom_model": {
            "$ref": "#/$defs/StardistpretrainedModel",
            "title": "Custom Model",
            "description": "Allows you to specify the path of a custom trained stardist model (takes precedence over `model_type`)."
          },
          "advanced_parameters": {
            "$ref": "#/$defs/AdvancedStardistParams",
            "default": {
              "normalization": {
                "lower_bound": null,
                "lower_percentile": null,
                "norm_type": "default",
                "upper_bound": null,
                "upper_percentile": null
              },
              "sparse": true,
              "prob_thresh": null,
              "nms_thresh": null,
              "scale": [
                1.0,
                1.0,
                1.0
              ],
              "n_tiles": [
                1,
                1,
                1
              ],
              "show_tile_progress": false,
              "verbose": false,
              "predict_kwargs": null,
              "nms_kwargs": null
            },
            "title": "Advanced Parameters",
            "description": "Advanced parameters for Stardist segmentation."
          },
          "overwrite": {
            "default": true,
            "title": "Overwrite",
            "type": "boolean",
            "description": "Whether to overwrite an existing label image. Defaults to True."
          }
        },
        "required": [
          "zarr_url",
          "channel"
        ],
        "type": "object",
        "title": "StardistSegmentationTask"
      },
      "docs_link": "https://github.com/pelkmanslab/abbott-stardist-task"
    }
  ],
  "has_args_schemas": true,
  "args_schema_version": "pydantic_v2",
  "authors": "Ruth Hornbachner"
}
